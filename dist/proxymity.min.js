var proxymity=function(e){function t(e){return Array.prototype.slice.call(e||[])}function n(e,t){return e&&i(e.length)&&Array.prototype.forEach.call(e,t)}function r(e){return"function"==typeof e}function o(e){return"string"==typeof e}function i(e){return"number"==typeof e&&!isNaN(e)}function a(e){return"object"==typeof e}function c(e){return Object.getOwnPropertyNames(e)}function u(e,t){var n,r,o;return void 0===t||e>t?(r=e,n=t||0):(n=e,r=t),o=r-n,Math.round(Math.random()*(o+.9998)-.4999)+n}var f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_";function s(e=16){for(var t=f[u(51)],n=1;n<e;n++)t+=f[u(62)];return t}function l(e,t){var r=c(t);for(var o in e)t[o]=e[o],r.splice(r.indexOf(o),1);n(r,function(e,n){e||"length"===n||delete t[n]}.bind(null,Array.isArray(t)))}function p(e,t,n){return Object.defineProperty(e,t,{value:n}),n}function v(e){return e.trim()[0].match(/[\w\_\$]/)?".":""}var h=function(){var e={},t={},o={},i=(o.watch=function(n,o,i){var a,c,u;for(var f in r(o)?(a=n,c=o,i=i||{}):(a="**",c=n,i=o||{}),i)c.key=i.key;if(a.indexOf("*")>-1){var s=a.replace(/([!@#$%^&*(){}[\]\<\>:'"`\-_,./\\+-])/g,"\\$1").replace(/\\\*\\\*/g,".*").replace(/\\\*/,"[^:.]+"),l=t[a]=t[a]||{regex:new RegExp(s),listeners:[]},p=l.listeners;u=function(){l.listeners.length||delete t[a]}}else{p=e[a]=e[a]||[];u=function(){e[a]||delete e[a]}}return p.push(c),function(){p.splice(p.indexOf(c),1),u()}},{}),a=o.emit=function(r,o={}){for(var a=e[r]&&e[r].slice(),c=0;a&&c<a.length;c++)e[r].indexOf(a[c])>-1&&a[c](o,r);for(var u in t){var f=t[u];r.match(f.regex)&&n(f.listeners,function(e){e(o,r)})}return i[r]=o},f={},l=0,p=s(u(32,48)),v=!1;o.async=function(e,t={}){v||(window.postMessage(p,"*"),v=!0),f[e]=t,t.f=l+=1,t.priority=t.priority||0};window.addEventListener("message",function(e){if(e.data===p){e.stopPropagation();var t=f;v=!1,f={},l=0;var r=c(t);r.sort(function(e,n){return t[e].priority>t[n].priority?-1:t[e].priority<t[n].priority?1:t[e].f>t[n].f?1:t[e].f<t[n].f?-1:0}),a("asyncstart",{payload:t,order:r}),n(r,function(e){a(e,t[e])}),a("asyncend",t),v||function(){for(var e in a("renderend"),i)delete i[e]}()}});o.last=function(e){return i[e]},o.next=function(e){return f[e]};return o}();function y(e){return e&&Object.getPrototypeOf(e)===Object.prototype?D(e):e&&Object.getPrototypeOf(e)===Array.prototype&&I(e),e}function d(e){var t=e&&Object.getPrototypeOf(e);return t===Array.prototype||t===Object.prototype||t===S||t===L}function g(e){return Object.setPrototypeOf(e,g.prototype),e}g.prototype=Object.create(Function.prototype);var m=s(u(32,48)),b=0;function O(e){if(d(e)){e.hasOwnProperty(Symbol.toPrimitive)&&r(e[Symbol.toPrimitive])||function(e){if(d(e)&&!e.hasOwnProperty(Symbol.toPrimitive)){var t={};Array.isArray(e)&&(t.length=(++b).toString()),Object.defineProperty(e,Symbol.toPrimitive,{value:function(e){switch(e){case"number":return c(this).length;case"string":return c(this).length?JSON.stringify(this):"";case m:return t;default:return!!c(this).length}}})}}(e);var t=e[Symbol.toPrimitive](m);return"object"==typeof t&&t}return{}}var w=!1;function k(e,t,r,i=!1){if(!e.hasOwnProperty(t)){var a=O(e),u=a[t]=a[t]||(++b).toString(),f=g(function(e,t=!0){t&&h.async(e+":"+u);var i=d(r)&&c(r);if(i){if(Array.isArray(r)){var a=O(r);a&&o(a.length)&&h.async(e+":"+a.length,{priority:1})}n(i,function(t){w=!0;var n=r[t];w=!1,n instanceof g&&n(e)})}});y(r),Object.defineProperty(e,t,{enumerable:i,configurable:!0,get:function(){return w?(w=!1,f):(Array.isArray(r)?h.emit("get",O(r).length):h.emit("get",u),r)},set:function(n){return n===r?r:(f("remap",!1),void 0===n?(h.async("del:"+u),delete e[t]):(h.async("set:"+u),r=y(n)))}}),h.async("set:"+u)}}function A(e,t,n){var o=t[n];return r(t[n])&&(o=function(){if(Array.isArray(this))var e=this.length;var r=t[n].apply(this,Array.from(arguments));return i(e)&&e!==this.length&&h.async("set:"+O(this).length,{priority:1}),r}),k(e,n,o,t.propertyIsEnumerable(n))}var P=!1,j=["constructor","toJSON"],x={get:function(e,t,n){if(-1===j.indexOf(t)){if(t in e){for(var r=Object.getPrototypeOf(e),o=n,i=n,a=Object.getPrototypeOf(o);a!==r;)i=o,o=a,a=Object.getPrototypeOf(o);A(i,e,t)}else if(P)return x.set(e,t,{},n),n[t];return Reflect.get(e,t,n)}},set:function(e,t,n,r){var o=Array.isArray(r);if(o)var i=r.length;return k(r,t,n,!0),o&&r.length!==i&&h.async("set:"+O(r).length),!0}};function E(t,n){var r,o=this;return T(function(){P=!0,r=e.call(o,"this"+v(t)+t),P=!1},function(){P=!0;var i=e.call(o,"this"+v(t)+t);P=!1,i!==r&&(r=i,n(i))})}function N(e){var t={};k(t,"watch",E),k(t,"toString",function(){return Object.getOwnPropertyNames(this).length?JSON.stringify(this):""});for(var r=e;r;)n(Object.getOwnPropertyNames(r),A.bind(this,t,r)),r=Object.getPrototypeOf(r);return Object.setPrototypeOf(t,new Proxy(e,x)),t}function C(e,t){return n(Object.getOwnPropertyNames(t),function(e){var n=t[e],r=t.propertyIsEnumerable(e);Array.isArray(t)&&"length"===e||(delete t[e],k(t,e,n,r))}),Object.setPrototypeOf(t,e)}var S=N(Array.prototype),L=N(Object.prototype),I=C.bind(this,S),D=C.bind(this,L);function T(e,t,o=[]){e();var i=h.last("get");if(r(t)){t=[{to:"del",fn:t},{to:"set",fn:t}]}n(t,function(e){var t=e.to+":"+i;o.push(h.watch(t,e.fn)),e.fn(h.last(t))});var a=function(){n(o,function(e){e()}),o.length=0},c=function(){a(),T(e,t,o)};return o.push(h.watch("remap:"+i,c)),o.push(h.watch("del:"+i,c)),a}function B(t,r,o){var i=[],a=t.textContent.replace(/\{\:([\s\S]*?)\:\}(\|(\s|\n)*\{[\s\S]*?\}(\s|\n)*\|)?/g,function(e,t,n){return i.push({run:t,on:n&&n.replace(/^\|[\s\n]*\{|\}[\s\n]*\|$/g,"").split(/\}[\s\n]*\,[\s\n]*\{/g)}),"{::}"}).split("{::}");if(i.length){var c=[],u=function(n){t.textContent=a.reduce(function(t,o,a){var c="";return i[a]&&(a===n?(P=!0,c=i[a].cache=e.call(r,i[a].run),P=!1):c=i[a].cache),t+o+c},"")};return n(i,function(t,i){t.on?n(t.on,function(t){c.push(T(function(){P=!0,e.call(r,"this."+o+v(t)+t),P=!1},function(){u(i)}))}):u(i)}),function(){n(c,function(e){e()})}}}var M=Object.create(Array.prototype);p(M,"appendTo",function(e){if(o(e))return M.appendTo.call(this,document.querySelector(e));var t=e;return n(this,function(e){t.appendChild(e)}),this}),p(M,"detach",function(){return n(this,function(e){var t=e.parentElement;t&&t.removeChild(e)}),this}),p(M,"unlink",function(){return $(this),this});var J=["renderend"];function R(e,t){n(e,function(e){t(e),R(e.childNodes,t)})}function $(e){R(e,function(e){e.dispatchEvent(new CustomEvent(F))})}p(M,"when",function(e){if(-1===J.indexOf(e))throw new Error("Cannot subscribe to "+e);return new Promise(function(t){var n=h.watch(e,function(){n(),t()})})});var F=s(u(32,48));function H(r,i,a,c){var u=Date.now();console.warn("initializing repeater",a);var f=T(function(){if(a.eventId)return h.emit("get",a.eventId),delete a.eventId;var t,n=function(){return n};n.in=function(e){if(!(t=O(e))||!o(t.length))throw new Error("Improper usage of key(string).in(array): in(array) is not provided with a proxified object of the same root evaluating ["+a.n.textContent+"]");a.c=e},n.end=function(){},e.call(a.n,a.n.textContent,{key:n},!0),h.emit("get",t.length)},function(){var e=Date.now();console.warn("begin length set",a);var o,u,f,s=a.t,l=s.indexOf(a.u),p=s.indexOf(a.n),v=a.u.parentNode,h=(o=s.slice(p+1,l),u=a.key,f=[],n(o,function(e){var t=e[u];f[t]=f[t]||[],f[t].push(e)}),f),y=a.c.length;if(h.length<y){for(var d=document.createDocumentFragment();h.length!==y;){var g=a.i.map(function(e){return e.cloneNode(!0)}),m=function(e,t){c(t),R(t,function(t){Object.defineProperty(t,a.key,{configurable:!0,enumerable:!1,get:function(){return e}})})}.bind(this,h.length);m(g),q(t(g),r,i,m),v&&n(g,function(e){d.appendChild(e)}),a.m&&n(g,function(e){e instanceof HTMLElement&&a.m(e)}),s.splice.apply(s,[l,0].concat(g)),l+=g.length,h.push(g)}v.insertBefore(d,a.u)}else if(h.length>y)for(;h.length!==y;){var b=h.pop();n(b,function(e){s.splice(s.indexOf(e),1),e.parentNode&&e.parentNode.removeChild(e)}),$(b)}console.warn("end length set after (ms):",Date.now()-e,a)});return console.warn("ending repeater process after (ms):",Date.now()-u,a),f}function _(e){return function(t){t.stopPropagation(),n(e,function(e){e()})}}function q(i,a,c,u){var f,s=function(e){if(f)throw new Error("Improper usage of key(string).in(array): key(string) cannot be nested on the same level");return f={key:e},s};return s.in=function(e){if(!f)throw new Error("Improper usage of key(string).in(array): key(string) not called");if(f.c)throw new Error("Improper usage of key(string).in(array): in(array) called before key");var t=O(e);if(!t||!o(t.length))throw new Error("Improper usage of key(string).in(array): in(array) is not provided with a proxified object of the same root");f.eventId=t.length,f.c=e,f.i=[]},s.end=function(e){if(!(f&&f.key&&f.i&&f.i.length))throw new Error("Improper usage of key.end([onClone]): key(string).in(array) is not called properly prior to calling key.end([onClone])");f.t=i,f.u=f.i.pop(),r(e)&&(f.m=e);for(var t=f.i,n=i.length-1;n>=0;n--)if(-1!==t.indexOf(i[n])){var o=i[n].parentNode;o&&o.removeChild(i[n]),i.splice(n,1)}var s=f.n=f.u.previousSibling,l=_([H(a,c,f,u),function(){s.removeEventListener(F,l)}]);s.addEventListener(F,l),f=void 0},n(t(i),function(t){if(f&&f.i&&f.i.push(t),t instanceof Comment&&"foreach:"===t.textContent.trim().substr(0,8).toLowerCase()){if(z(t,a,c,u),e.call(t,t.textContent,{key:s}),!(!f||f.key&&f.i))throw new Error("Improper usage of key(string).in(array): in(array) not called in conjunction with key");f&&!f.n&&(f.n=t)}}),n(i,function(e){e[c]!==a&&z(e,a,c,u)}),Object.setPrototypeOf(i,M)}function z(r,o,c,f){var p=[];if(Object.defineProperty(r,c,{configurable:!0,get:function(){return o},set:function(e){return a(e)&&l(e,o),o}}),p.push(function(){delete r[c]}),r instanceof CharacterData){var h=B(r,r,c);h&&p.push(h)}else q(t(r.childNodes),o,c,f);n(r.attributes,function(t){var o=B(t,r,c);if(o&&p.push(o),!("name"!==t.name||"INPUT"!==r.nodeName&"TEXTAREA"!==r.nodeName&"SELECT"!==r.nodeName)){var a=function(){try{P=!0;var n=e.call(r,"this."+c+v(t.value)+t.value,{},!0);P=!1,n!==r.value&&(r.value=n)}catch(e){r.value=null,P=!1}},f="value",l=r.type.toLowerCase();"number"===l||"range"===l?(f="valueAsNumber",a=function(){try{P=!0;var n=e.call(r,"this."+c+v(t.value)+t.value,{},!0);P=!1,i(n)&&n!==r.valueAsNumber?r.valueAsNumber=n:n!==r.valueAsNumber&&(r.value=null)}catch(e){r.value=null,P=!1}}):"checkbox"===l?(f="checked",a=function(){try{P=!0;var n=e.call(r,"this."+c+v(t.value)+t.value,{},!0);P=!1,"boolean"==typeof n&&n!==r.checked?r.checked=n:n!==r.checked&&(r.checked=!1)}catch(e){r.checked=!1,P=!1}}):"radio"===l?a=function(){try{P=!0;var n=e.call(r,"this."+c+v(t.value)+t.value,{},!0);P=!1,r.value!==n||r.checked?r.value!==n&&r.checked&&(r.checked=!1):r.checked=!0}catch(e){r.checked=!1,P=!1}}:"date"!==l&&"month"!==l&&"week"!==l&&"time"!==l&&"datetime-local"!==l||(f="valueAsDate",a=function(){try{P=!0;var n=e.call(r,"this."+c+v(t.value)+t.value,{},!0);P=!1,n instanceof Date&&n.getTime()!==r.valueAsDate.getTime()?r.valueAsDate=n:n instanceof Date||(r.value=null)}catch(e){r.value=null,P=!1}}),p.push(T(function(){P=!0,e.call(r,"this."+c+v(t.value)+t.value),P=!1},[{to:"del",fn:a},{to:"set",fn:a}]));var h=["change","keyup","click"],y=function(n){var o=s(u(32,48));e.call(r,"this."+c+v(t.value)+t.value+" = "+o,{[o]:r[f]})};n(h,function(e){r.addEventListener(e,y)}),p.push(function(){n(h,function(e){r.removeEventListener(e,y)})})}}),p.push(function(){r.removeEventListener(F,y)});var y=_(p);return r.addEventListener(F,y),Object.setPrototypeOf([r],M)}var U=function(e,n={},r="app"){var i=y(n);h.async("set:");var c=function e(n,r,i,a=function(){}){if(o(n)){var c=document.createElement("template");return c.innerHTML=n.trim(),e(c.content.childNodes,r,i,a)}return n instanceof NodeList||n instanceof Array&&n.reduce(function(e,t){return e&&t instanceof Node},!0)?q(t(n),r,i,a):n instanceof Node?z(n,r,i,a):void 0}(e,i,r);return Object.defineProperty(c,r,{get:function(){return i},set:function(e){a(e)&&l(e,i)}}),c};return p(U,"convert",y),U}(function(s,sv={},t=!1){try{with(sv)return eval(s)}catch(o3o){if(t)throw o3o;return console.error("failed to evaluate expression ["+s+"]",this,o3o),""}});"undefined"!=typeof module&&(module.exports=proxymity);