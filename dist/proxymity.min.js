var proxymity=function(e){function t(e){return Array.prototype.slice.call(e||[])}function n(e,n){return t(e).forEach(n)}function r(e){return"function"==typeof e}function o(e){return"string"==typeof e}function i(e){return"number"==typeof e&&!isNaN(e)}function a(e){return"object"==typeof e}function c(e){return Object.getOwnPropertyNames(e)}function u(e,t){var n,r,o;return void 0===t||e>t?(r=e,n=t||0):(n=e,r=t),o=r-n,Math.round(Math.random()*(o+.9998)-.4999)+n}var f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_";function s(e=16){for(var t=f[u(51)],n=1;n<e;n++)t+=f[u(62)];return t}function l(e,t){var r=c(t);for(var o in e)t[o]=e[o],r.splice(r.indexOf(o),1);n(r,function(e,n){e||"length"===n||delete t[n]}.bind(null,Array.isArray(t)))}function p(e,t,n){return Object.defineProperty(e,t,{value:n}),n}function v(e){return e.trim()[0].match(/[\w\_\$]/)?".":""}var h=function(){var e={},t={},o={},i=(o.watch=function(n,o,i){var a,c;for(var u in r(o)?(a=n,c=o,i=i||{}):(a="**",c=n,i=o||{}),i)c.key=i.key;if(a.indexOf("*")>-1)var f=a.replace(/([!@#$%^&*(){}[\]\<\>:'"`\-_,./\\+-])/g,"\\$1").replace(/\\\*\\\*/g,".*").replace(/\\\*/,"[^:.]+"),s=(t[a]=t[a]||{regex:new RegExp(f),listeners:[]}).listeners;else s=e[a]=e[a]||[];return s.push(c),function(){s.splice(s.indexOf(c),1)}},{}),a=o.emit=function(r,o={}){for(var a=e[r]&&e[r].slice(),c=0;a&&c<a.length;c++)e[r].indexOf(a[c])>-1&&a[c](o,r);for(var u in t){var f=t[u];r.match(f.regex)&&n(f.listeners,function(e){e(o,r)})}return i[r]=o},f={},l=0,p=s(u(32,48)),v=!1;o.async=function(e,t={}){v||(window.postMessage(p,"*"),v=!0),f[e]=t,t.f=l+=1};window.addEventListener("message",function(e){if(e.data===p){e.stopPropagation();var t=f;v=!1,f={},l=0;var r=c(t);r.sort(function(e,n){return t[e].f>t[n].f?1:t[e].f<t[n].f?-1:0}),a("asyncstart",{payload:t,order:r}),n(r,function(e){a(e,t[e])}),a("asyncend",t),v||function(){for(var e in a("renderend"),i)delete i[e]}()}});o.last=function(e){return i[e]},o.next=function(e){return f[e]};return o}();function y(e){return e&&Object.getPrototypeOf(e)===Object.prototype?S(e):e&&Object.getPrototypeOf(e)===Array.prototype&&L(e),e}function d(e){var t=e&&Object.getPrototypeOf(e);return t===Array.prototype||t===Object.prototype||t===E||t===C}function g(e){return Object.setPrototypeOf(e,g.prototype),e}g.prototype=Object.create(Function.prototype);var m=s(u(32,48));function b(e){if(d(e)){r(e[Symbol.toPrimitive])||function(e){if(d(e)&&void 0===e[Symbol.toPrimitive]){var t={};Array.isArray(e)&&(t.length=s(u(32,48))),Object.defineProperty(e,Symbol.toPrimitive,{value:function(e){switch(e){case"number":return c(this).length;case"string":return c(this).length?JSON.stringify(this):"";case m:return t;default:return!!c(this).length}}})}}(e);var t=e[Symbol.toPrimitive](m);return"object"==typeof t&&t}return{}}var O=!1;function w(e,t,r,i=!1){if(!e.hasOwnProperty(t)){var a=b(e),f=a[t]=a[t]||s(u(32,48)),l=g(function(e,t=!0){var i=d(r)&&c(r);i&&n(i,function(t){O=!0;var n=r[t];if(n instanceof g)n(e);else if(Array.isArray(r)&&"length"===t){var i=b(r);if(i&&o(i.length)){var a={};h.async(e+":"+i.length,a),a.f=-1}}O=!1}),t&&h.async(e+":"+f)});y(r),Object.defineProperty(e,t,{enumerable:i,configurable:!0,get:function(){return O?(O=!1,l):(Array.isArray(r)?h.emit("get",b(r).length):h.emit("get",f),r)},set:function(n){return n===r?r:(l("remap",!1),void 0===n?(h.async("del:"+f),delete e[t]):(h.async("set:"+f),r=y(n)))}}),h.async("set:"+f)}}function k(e,t,n){var o=t[n];return r(t[n])&&(o=function(){if(Array.isArray(this))var e=this.length;var r=t[n].apply(this,Array.from(arguments));if(i(e)&&e!==this.length){var o={};h.async("set:"+b(this).length,o),o.f=-1}return r}),w(e,n,o,t.propertyIsEnumerable(n))}var A=!1,P=["constructor","toJSON"],j={get:function(e,t,n){if(-1===P.indexOf(t)){if(t in e){for(var r=Object.getPrototypeOf(e),o=n,i=n,a=Object.getPrototypeOf(o);a!==r;)i=o,o=a,a=Object.getPrototypeOf(o);k(i,e,t)}else if(A)return j.set(e,t,{},n),n[t];return Reflect.get(e,t,n)}},set:function(e,t,n,r){return w(r,t,n,!0),!0}};function N(e){var t={};w(t,"toString",function(){return Object.getOwnPropertyNames(this).length?JSON.stringify(this):""});for(var r=e;r;)n(Object.getOwnPropertyNames(r),k.bind(this,t,r)),r=Object.getPrototypeOf(r);return Object.setPrototypeOf(t,new Proxy(e,j)),t}function x(e,t){return n(Object.getOwnPropertyNames(t),function(e){var n=t[e],r=t.propertyIsEnumerable(e);Array.isArray(t)&&"length"!==e&&(delete t[e],w(t,e,n,r))}),Object.setPrototypeOf(t,e)}var E=N(Array.prototype),C=N(Object.prototype),L=x.bind(this,E),S=x.bind(this,C);function I(e,t,o=[]){e();var i=h.last("get");if(r(t)){t=[{to:"del",fn:t},{to:"set",fn:t}]}n(t,function(e){var t=e.to+":"+i;o.push(h.watch(t,e.fn)),e.fn(h.last(t))});var a=function(){n(o,function(e){e()}),o.length=0},c=function(){a(),I(e,t,o)};return o.push(h.watch("remap:"+i,c)),o.push(h.watch("del:"+i,c)),a}function T(t,r,o){var i=t.textContent,a=[];if(i.replace(/\{\:([\s\S]*?)\:\}(\|(\s|\n)*\{[\s\S]*?\}(\s|\n)*\|)?/g,function(e,t,n){a.push({drop:e,run:t,on:n&&n.replace(/^\|[\s\n]*\{|\}[\s\n]*\|$/g,"").split(/\}[\s\n]*\,[\s\n]*\{/g)})}),a.length){var c=[],f=function(){var o,c;A=!0,t.textContent=(o=i,c=r,n(a,function(t){o=o.replace(t.drop,function(){return e.call(c,t.run)})}),o),A=!1};return n(a,function(t){s(u(32,48));if(t.on){n(t.on,function(t){c.push(I(function(){A=!0,e.call(r,"this."+o+v(t)+t),A=!1},f))})}else f()}),function(){n(c,function(e){e()})}}}var B=Object.create(Array.prototype);p(B,"appendTo",function(e){if(o(e))return B.appendTo.call(this,document.querySelector(e));var t=e;return n(this,function(e){t.appendChild(e)}),this}),p(B,"detach",function(){return n(this,function(e){var t=e.parentElement;t&&t.removeChild(e)}),this}),p(B,"unlink",function(){return J(this),this});var D=["renderend"];function M(e,t){n(e,function(e){t(e),M(e.childNodes,t)})}function J(e){M(e,function(e){e.dispatchEvent(new CustomEvent(R))})}p(B,"when",function(e){if(-1===D.indexOf(e))throw new Error("Cannot subscribe to "+e);return new Promise(function(t){var n=h.watch(e,function(){n(),t()})})});var R=s(u(32,48));function $(t,r,i,a){return I(function(){var t,n=function(){return n};n.in=function(e){if(!(t=b(e))||!o(t.length))throw new Error("Improper usage of key(string).in(array): in(array) is not provided with a proxified object of the same root");i.c=e},n.end=function(){},e.call(i.n,i.n.textContent,{key:n},!0),h.emit("get",t.length)},function(){var e,o,c,u=i.t,f=u.indexOf(i.u),s=u.indexOf(i.n),l=i.u.parentNode,p=(e=u.slice(s+1,f),o=i.key,c=[],n(e,function(e){var t=e[o];c[t]=c[t]||[],c[t].push(e)}),c),v=i.c.length;if(p.length<v)for(;p.length!==v;){var h=i.i.map(function(e){return e.cloneNode(!0)}),y=function(e,t){a(t),M(t,function(t){Object.defineProperty(t,i.key,{configurable:!0,enumerable:!1,get:function(){return e}})})}.bind(this,p.length);y(h),_(h,t,r,y),l&&n(h,function(e){l.insertBefore(e,i.u)}),i.m&&n(h,function(e){e instanceof HTMLElement&&i.m(e)}),u.splice.apply(u,[f,0].concat(h)),f+=h.length,p.push(h)}else if(p.length>v)for(;p.length!==v;){var d=p.pop();n(d,function(e){u.splice(u.indexOf(e),1),e.parentNode&&e.parentNode.removeChild(e)}),J(d)}})}function H(e){return function(t){t.stopPropagation(),n(e,function(e){e()})}}function _(t,o,i,a){var c,u=function(e){if(c)throw new error("Improper usage of key(string).in(array): key(string) cannot be nested on the same level");return c={key:e},u};return u.in=function(e){if(!c)throw new Error("Improper usage of key(string).in(array): key(string) not called");if(c.c)throw new Error("Improper usage of key(string).in(array): in(array) called before key");c.i=[]},u.end=function(e){if(!(c&&c.key&&c.i&&c.i.length))throw new Error("Improper usage of key.end([onClone]): key(string).in(array) is not called properly prior to calling key.end([onClone])");c.t=t,c.u=c.i.pop(),r(e)&&(c.m=e);for(var n=c.i,u=t.length-1;u>=0;u--)if(-1!==n.indexOf(t[u])){var f=t[u].parentNode;f&&f.removeChild(t[u]),t.splice(u,1)}var s=c.n=c.u.previousSibling,l=H([$(o,i,c,a),function(){s.removeEventListener(R,l)}]);s.addEventListener(R,l),c=void 0},n(t,function(t){if(c&&c.i&&c.i.push(t),t instanceof Comment&&"foreach:"===t.textContent.trim().substr(0,8).toLowerCase()){if(q(t,o,i,a),e.call(t,t.textContent,{key:u}),!(!c||c.key&&c.i))throw new Error("Improper usage of key(string).in(array): in(array) not called in conjunction with key");c&&!c.n&&(c.n=t)}}),n(t,function(e){e[i]!==o&&q(e,o,i,a)}),Object.setPrototypeOf(t,B)}function q(t,r,o,c){var f=[];if(Object.defineProperty(t,o,{configurable:!0,get:function(){return r},set:function(e){return a(e)&&l(e,r),r}}),f.push(function(){delete t[o]}),t instanceof CharacterData){var p=T(t,t,o);p&&f.push(p)}else _(t.childNodes,r,o,c);n(t.attributes,function(r){var a=T(r,t,o);if(a&&f.push(a),!("name"!==r.name||"INPUT"!==t.nodeName&"TEXTAREA"!==t.nodeName&"SELECT"!==t.nodeName)){var c=function(){try{A=!0;var n=e.call(t,"this."+o+v(r.value)+r.value,{},!0);A=!1,n!==t.value&&(t.value=n)}catch(e){t.value=null,A=!1}},l="value",p=t.type.toLowerCase();"number"===p||"range"===p?(l="valueAsNumber",c=function(){try{A=!0;var n=e.call(t,"this."+o+v(r.value)+r.value,{},!0);A=!1,i(n)&&n!==t.valueAsNumber?t.valueAsNumber=n:n!==t.valueAsNumber&&(t.value=null)}catch(e){t.value=null,A=!1}}):"checkbox"===p?(l="checked",c=function(){try{A=!0;var n=e.call(t,"this."+o+v(r.value)+r.value,{},!0);A=!1,"boolean"==typeof n&&n!==t.checked?t.checked=n:n!==t.checked&&(t.checked=!1)}catch(e){t.checked=!1,A=!1}}):"radio"===p?c=function(){try{A=!0;var n=e.call(t,"this."+o+v(r.value)+r.value,{},!0);A=!1,t.value!==n||t.checked?t.value!==n&&t.checked&&(t.checked=!1):t.checked=!0}catch(e){t.checked=!1,A=!1}}:"date"!==p&&"month"!==p&&"week"!==p&&"time"!==p&&"datetime-local"!==p||(l="valueAsDate",c=function(n){try{A=!0;var i=e.call(t,"this."+o+v(r.value)+r.value,{},!0);A=!1,i instanceof Date&&i.getTime()!==t.valueAsDate.getTime()?t.valueAsDate=i:i instanceof Date||(t.value=null)}catch(e){t.value=null,A=!1}}),f.push(I(function(){A=!0,e.call(t,"this."+o+v(r.value)+r.value),A=!1},[{to:"del",fn:c},{to:"set",fn:c}]));var h=["change","keyup","click"],y=function(n){var i=s(u(32,48));e.call(t,"this."+o+v(r.value)+r.value+" = "+i,{[i]:t[l]})};n(h,function(e){t.addEventListener(e,y)}),f.push(function(){n(h,function(e){t.removeEventListener(e,y)})})}}),f.push(function(){t.removeEventListener(R,h)});var h=H(f);return t.addEventListener(R,h),Object.setPrototypeOf([t],B)}var F=function(e,n={},i="app"){var c;c=r(n[Symbol.toPrimitive])&&o(n[Symbol.toPrimitive](objectId))?n:y(n),h.async("set:");var u=function e(n,r,i,a=function(){}){if(o(n)){var c=document.createElement("template");return c.innerHTML=n.trim(),e(c.content.childNodes,r,i,a)}return n instanceof NodeList||n instanceof Array&&n.reduce(function(e,t){return e&&t instanceof Node},!0)?_(t(n),r,i,a):n instanceof Node?q(n,r,i,a):void 0}(e,c,i);return Object.defineProperty(u,i,{get:function(){return c},set:function(e){a(e)&&l(e,c)}}),u};return p(F,"convert",y),F}(function(s,sv={},t=!1){try{with(sv)return eval(s)}catch(o3o){if(t)throw o3o;return console.error("failed to evaluate expression ["+s+"]",this,o3o),""}});"undefined"!=typeof module&&(module.exports=proxymity);