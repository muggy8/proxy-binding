var proxymity=function(e){function t(e){return Array.prototype.slice.call(e||[])}function n(e,n){return t(e).forEach(n)}function r(e){return"function"==typeof e}function o(e){return"string"==typeof e}function i(e){return"number"==typeof e&&!isNaN(e)}function a(e){return"object"==typeof e}function c(e){return Object.getOwnPropertyNames(e)}function u(e,t){var n,r,o;return void 0===t||e>t?(r=e,n=t||0):(n=e,r=t),o=r-n,Math.round(Math.random()*(o+.9998)-.4999)+n}var f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_";function s(e=16){for(var t=f[u(51)],n=1;n<e;n++)t+=f[u(62)];return t}function l(e,t){var r=c(t);for(var o in e)t[o]=e[o],r.splice(r.indexOf(o),1);n(r,function(e,n){e||"length"===n||delete t[n]}.bind(null,Array.isArray(t)))}function p(e,t,n){return Object.defineProperty(e,t,{value:n}),n}function v(e){return e.trim()[0].match(/[\w\_\$]/)?".":""}var h=function(){var e={},t={},o={},i=(o.watch=function(n,o,i){var a,c;for(var u in r(o)?(a=n,c=o,i=i||{}):(a="**",c=n,i=o||{}),i)c.key=i.key;if(a.indexOf("*")>-1)var f=a.replace(/([!@#$%^&*(){}[\]\<\>:'"`\-_,./\\+-])/g,"\\$1").replace(/\\\*\\\*/g,".*").replace(/\\\*/,"[^:.]+"),s=(t[a]=t[a]||{regex:new RegExp(f),listeners:[]}).listeners;else s=e[a]=e[a]||[];return s.push(c),function(){s.splice(s.indexOf(c),1)}},{}),a=o.emit=function(r,o={}){for(var a=e[r]&&e[r].slice(),c=0;a&&c<a.length;c++)e[r].indexOf(a[c])>-1&&a[c](o,r);for(var u in t){var f=t[u];r.match(f.regex)&&n(f.listeners,function(e){e(o,r)})}return i[r]=o},f={},l=0,p=s(u(32,48)),v=!1;o.async=function(e,t={}){v||(window.postMessage(p,"*"),v=!0),f[e]=t,t.f=l+=1};window.addEventListener("message",function(e){if(e.data===p){e.stopPropagation();var t=f;v=!1,f={},l=0;var r=c(t);r.sort(function(e,n){return t[e].f>t[n].f?1:t[e].f<t[n].f?-1:0}),a("asyncstart",{payload:t,order:r}),n(r,function(e){a(e,t[e])}),a("asyncend",t),v||function(){for(var e in a("renderend"),i)delete i[e]}()}});o.last=function(e){return i[e]},o.next=function(e){return f[e]};return o}();function y(e){return e&&Object.getPrototypeOf(e)===Object.prototype?T(e):e&&Object.getPrototypeOf(e)===Array.prototype&&S(e),e}function d(e){var t=e&&Object.getPrototypeOf(e);return t===Array.prototype||t===Object.prototype||t===C||t===L}function g(e){return Object.setPrototypeOf(e,g.prototype),e}g.prototype=Object.create(Function.prototype);var m=s(u(32,48));function b(e){if(d(e)){e.hasOwnProperty(Symbol.toPrimitive)&&r(e[Symbol.toPrimitive])||function(e){if(d(e)&&!e.hasOwnProperty(Symbol.toPrimitive)){var t={};Array.isArray(e)&&(t.length=s(u(32,48))),Object.defineProperty(e,Symbol.toPrimitive,{value:function(e){switch(e){case"number":return c(this).length;case"string":return c(this).length?JSON.stringify(this):"";case m:return t;default:return!!c(this).length}}})}}(e);var t=e[Symbol.toPrimitive](m);return"object"==typeof t&&t}return{}}var O=!1;function w(e,t,r,i=!1){if(!e.hasOwnProperty(t)){var a=b(e),f=a[t]=a[t]||s(u(32,48)),l=g(function(e,t=!0){var i=d(r)&&c(r);i&&n(i,function(t){O=!0;var n=r[t];if(O=!1,n instanceof g)n(e);else if(Array.isArray(r)&&"length"===t){var i=b(r);if(i&&o(i.length)){var a={};h.async(e+":"+i.length,a),a.f=-1}}}),t&&h.async(e+":"+f)});y(r),Object.defineProperty(e,t,{enumerable:i,configurable:!0,get:function(){return O?(O=!1,l):(Array.isArray(r)?h.emit("get",b(r).length):h.emit("get",f),r)},set:function(n){return n===r?r:(l("remap",!1),void 0===n?(h.async("del:"+f),delete e[t]):(h.async("set:"+f),r=y(n)))}}),h.async("set:"+f)}}function k(e,t,n){var o=t[n];return r(t[n])&&(o=function(){if(Array.isArray(this))var e=this.length;var r=t[n].apply(this,Array.from(arguments));if(i(e)&&e!==this.length){var o={};h.async("set:"+b(this).length,o),o.f=-1}return r}),w(e,n,o,t.propertyIsEnumerable(n))}var P=!1,A=["constructor","toJSON"],j={get:function(e,t,n){if(-1===A.indexOf(t)){if(t in e){for(var r=Object.getPrototypeOf(e),o=n,i=n,a=Object.getPrototypeOf(o);a!==r;)i=o,o=a,a=Object.getPrototypeOf(o);k(i,e,t)}else if(P)return j.set(e,t,{},n),n[t];return Reflect.get(e,t,n)}},set:function(e,t,n,r){return w(r,t,n,!0),!0}};function N(t,n){var r,o=this;return I(function(){P=!0,r=e.call(o,"this"+v(t)+t),P=!1},function(){P=!0;var i=e.call(o,"this"+v(t)+t);P=!1,i!==r&&(r=i,n(i))})}function x(e){var t={};w(t,"watch",N),w(t,"toString",function(){return Object.getOwnPropertyNames(this).length?JSON.stringify(this):""});for(var r=e;r;)n(Object.getOwnPropertyNames(r),k.bind(this,t,r)),r=Object.getPrototypeOf(r);return Object.setPrototypeOf(t,new Proxy(e,j)),t}function E(e,t){return n(Object.getOwnPropertyNames(t),function(e){var n=t[e],r=t.propertyIsEnumerable(e);Array.isArray(t)&&"length"===e||(delete t[e],w(t,e,n,r))}),Object.setPrototypeOf(t,e)}var C=x(Array.prototype),L=x(Object.prototype),S=E.bind(this,C),T=E.bind(this,L);function I(e,t,o=[]){e();var i=h.last("get");if(r(t)){t=[{to:"del",fn:t},{to:"set",fn:t}]}n(t,function(e){var t=e.to+":"+i;o.push(h.watch(t,e.fn)),e.fn(h.last(t))});var a=function(){n(o,function(e){e()}),o.length=0},c=function(){a(),I(e,t,o)};return o.push(h.watch("remap:"+i,c)),o.push(h.watch("del:"+i,c)),a}function D(t,r,o){var i=t.textContent,a=[];if(i.replace(/\{\:([\s\S]*?)\:\}(\|(\s|\n)*\{[\s\S]*?\}(\s|\n)*\|)?/g,function(e,t,n){a.push({drop:e,run:t,on:n&&n.replace(/^\|[\s\n]*\{|\}[\s\n]*\|$/g,"").split(/\}[\s\n]*\,[\s\n]*\{/g)})}),a.length){var c=[],f=function(){var o,c;P=!0,t.textContent=(o=i,c=r,n(a,function(t){o=o.replace(t.drop,function(){return e.call(c,t.run)})}),o),P=!1};return n(a,function(t){s(u(32,48));if(t.on){n(t.on,function(t){c.push(I(function(){P=!0,e.call(r,"this."+o+v(t)+t),P=!1},f))})}else f()}),function(){n(c,function(e){e()})}}}var B=Object.create(Array.prototype);p(B,"appendTo",function(e){if(o(e))return B.appendTo.call(this,document.querySelector(e));var t=e;return n(this,function(e){t.appendChild(e)}),this}),p(B,"detach",function(){return n(this,function(e){var t=e.parentElement;t&&t.removeChild(e)}),this}),p(B,"unlink",function(){return R(this),this});var M=["renderend"];function J(e,t){n(e,function(e){t(e),J(e.childNodes,t)})}function R(e){J(e,function(e){e.dispatchEvent(new CustomEvent($))})}p(B,"when",function(e){if(-1===M.indexOf(e))throw new Error("Cannot subscribe to "+e);return new Promise(function(t){var n=h.watch(e,function(){n(),t()})})});var $=s(u(32,48));function F(r,i,a,c){return I(function(){var t,n=function(){return n};n.in=function(e){if(!(t=b(e))||!o(t.length))throw new Error("Improper usage of key(string).in(array): in(array) is not provided with a proxified object of the same root");a.c=e},n.end=function(){},e.call(a.n,a.n.textContent,{key:n},!0),h.emit("get",t.length)},function(){var e,o,u,f=a.t,s=f.indexOf(a.u),l=f.indexOf(a.n),p=a.u.parentNode,v=(e=f.slice(l+1,s),o=a.key,u=[],n(e,function(e){var t=e[o];u[t]=u[t]||[],u[t].push(e)}),u),h=a.c.length;if(v.length<h){for(var y=document.createDocumentFragment();v.length!==h;){var d=a.i.map(function(e){return e.cloneNode(!0)}),g=function(e,t){c(t),J(t,function(t){Object.defineProperty(t,a.key,{configurable:!0,enumerable:!1,get:function(){return e}})})}.bind(this,v.length);g(d),_(t(d),r,i,g),p&&n(d,function(e){y.appendChild(e)}),a.m&&n(d,function(e){e instanceof HTMLElement&&a.m(e)}),f.splice.apply(f,[s,0].concat(d)),s+=d.length,v.push(d)}p.insertBefore(y,a.u)}else if(v.length>h)for(;v.length!==h;){var m=v.pop();n(m,function(e){f.splice(f.indexOf(e),1),e.parentNode&&e.parentNode.removeChild(e)}),R(m)}})}function H(e){return function(t){t.stopPropagation(),n(e,function(e){e()})}}function _(t,o,i,a){var c,u=function(e){if(c)throw new error("Improper usage of key(string).in(array): key(string) cannot be nested on the same level");return c={key:e},u};return u.in=function(e){if(!c)throw new Error("Improper usage of key(string).in(array): key(string) not called");if(c.c)throw new Error("Improper usage of key(string).in(array): in(array) called before key");c.i=[]},u.end=function(e){if(!(c&&c.key&&c.i&&c.i.length))throw new Error("Improper usage of key.end([onClone]): key(string).in(array) is not called properly prior to calling key.end([onClone])");c.t=t,c.u=c.i.pop(),r(e)&&(c.m=e);for(var n=c.i,u=t.length-1;u>=0;u--)if(-1!==n.indexOf(t[u])){var f=t[u].parentNode;f&&f.removeChild(t[u]),t.splice(u,1)}var s=c.n=c.u.previousSibling,l=H([F(o,i,c,a),function(){s.removeEventListener($,l)}]);s.addEventListener($,l),c=void 0},n(t,function(t){if(c&&c.i&&c.i.push(t),t instanceof Comment&&"foreach:"===t.textContent.trim().substr(0,8).toLowerCase()){if(q(t,o,i,a),e.call(t,t.textContent,{key:u}),!(!c||c.key&&c.i))throw new Error("Improper usage of key(string).in(array): in(array) not called in conjunction with key");c&&!c.n&&(c.n=t)}}),n(t,function(e){e[i]!==o&&q(e,o,i,a)}),Object.setPrototypeOf(t,B)}function q(r,o,c,f){var p=[];if(Object.defineProperty(r,c,{configurable:!0,get:function(){return o},set:function(e){return a(e)&&l(e,o),o}}),p.push(function(){delete r[c]}),r instanceof CharacterData){var h=D(r,r,c);h&&p.push(h)}else _(t(r.childNodes),o,c,f);n(r.attributes,function(t){var o=D(t,r,c);if(o&&p.push(o),!("name"!==t.name||"INPUT"!==r.nodeName&"TEXTAREA"!==r.nodeName&"SELECT"!==r.nodeName)){var a=function(){try{P=!0;var n=e.call(r,"this."+c+v(t.value)+t.value,{},!0);P=!1,n!==r.value&&(r.value=n)}catch(e){r.value=null,P=!1}},f="value",l=r.type.toLowerCase();"number"===l||"range"===l?(f="valueAsNumber",a=function(){try{P=!0;var n=e.call(r,"this."+c+v(t.value)+t.value,{},!0);P=!1,i(n)&&n!==r.valueAsNumber?r.valueAsNumber=n:n!==r.valueAsNumber&&(r.value=null)}catch(e){r.value=null,P=!1}}):"checkbox"===l?(f="checked",a=function(){try{P=!0;var n=e.call(r,"this."+c+v(t.value)+t.value,{},!0);P=!1,"boolean"==typeof n&&n!==r.checked?r.checked=n:n!==r.checked&&(r.checked=!1)}catch(e){r.checked=!1,P=!1}}):"radio"===l?a=function(){try{P=!0;var n=e.call(r,"this."+c+v(t.value)+t.value,{},!0);P=!1,r.value!==n||r.checked?r.value!==n&&r.checked&&(r.checked=!1):r.checked=!0}catch(e){r.checked=!1,P=!1}}:"date"!==l&&"month"!==l&&"week"!==l&&"time"!==l&&"datetime-local"!==l||(f="valueAsDate",a=function(n){try{P=!0;var o=e.call(r,"this."+c+v(t.value)+t.value,{},!0);P=!1,o instanceof Date&&o.getTime()!==r.valueAsDate.getTime()?r.valueAsDate=o:o instanceof Date||(r.value=null)}catch(e){r.value=null,P=!1}}),p.push(I(function(){P=!0,e.call(r,"this."+c+v(t.value)+t.value),P=!1},[{to:"del",fn:a},{to:"set",fn:a}]));var h=["change","keyup","click"],y=function(n){var o=s(u(32,48));e.call(r,"this."+c+v(t.value)+t.value+" = "+o,{[o]:r[f]})};n(h,function(e){r.addEventListener(e,y)}),p.push(function(){n(h,function(e){r.removeEventListener(e,y)})})}}),p.push(function(){r.removeEventListener($,y)});var y=H(p);return r.addEventListener($,y),Object.setPrototypeOf([r],B)}var U=function(e,n={},r="app"){var i=y(n);h.async("set:");var c=function e(n,r,i,a=function(){}){if(o(n)){var c=document.createElement("template");return c.innerHTML=n.trim(),e(c.content.childNodes,r,i,a)}return n instanceof NodeList||n instanceof Array&&n.reduce(function(e,t){return e&&t instanceof Node},!0)?_(t(n),r,i,a):n instanceof Node?q(n,r,i,a):void 0}(e,i,r);return Object.defineProperty(c,r,{get:function(){return i},set:function(e){a(e)&&l(e,i)}}),c};return p(U,"convert",y),U}(function(s,sv={},t=!1){try{with(sv)return eval(s)}catch(o3o){if(t)throw o3o;return console.error("failed to evaluate expression ["+s+"]",this,o3o),""}});"undefined"!=typeof module&&(module.exports=proxymity);